# 错误处理

## 处理错误

Nuxt 3 是一个全栈框架，这意味着在不同上下文中会出现一些无法预防的用户运行时错误:
1. 在Vue渲染的声明周期内的错误(SSR+SPA)
1. 在AP或Nitro服务的生命周期内的错误
1. 服务器和客户端启动的错误(SSR+SPA)


### Vue 渲染时生命周期内的错误 (SSR + SPA)

你可以使用[`onErrorCaptured`](https://vuejs.org/api/composition-api-lifecycle.html#onerrorcaptured)监听Vue的错误

此外Nuxt提供了一个 `vue:error` 钩子，但有错误本抛到顶层时，会调用这个钩子。

如果你使用的是错误报告框架，你可以通过[]()提供全局的处理程序。它将接收所有的Vue错误，即使它们已经被处理。

#### 全局错误报告框架示例：

```js
export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.vueApp.config.errorHandler = (error, context) => {
    // ...
  }
})
```

### 服务器和客户端启动错误S (SSR + SPA)

如果在启动Nuxt应用时报错，触发 `app:error`钩子
包括：
* 运行Nuxt 插件
* 处理  `app:created` `app:beforeMount` 钩子
* 挂在app(在客户端),不过你应该使用`onErrorCaptured`或者`vue:error`来处理这种情况。
* 处理 `app:moounted` 钩子。



### 在API 或者Nitro服务生命周期时报错

目前，无法在服务端处理这些程序，但你可以渲染一个错误页面（请参阅下一章）

## 渲染一个错误页面

当Nuxt 遇到致命错误时，无论是在服务器生命周期内，还是渲染Vue应用时（SSR 和 SPA）.它都会响应一个JSON（如果请求时头部设置了 `Accept: application/json`）数据，或者一个HTML错误页面.

可以在项目中直接添加`~/error.vue`定义一个错误页面。 和`app.vue` 同级，这个页面有一个属性`error`，其中包含你要处理的错误信息。

当你打算离开错误页面时，你可以调用`clearerror`辅助函数，该函数接收一个可选的重定向路由参数（例如：你想要跳转到一个安全的页面）。

::alert{type="warning"}
在确定使用任何Nuxt插件前比如`$route` 或`useRouter` ，一定要检查，就像插件报错一样，在你清除错误前，程序不会重新运行。
::

### 例子

```vue [error.vue]
<template>
  <button @click="handleError">Clear errors</button>
</template>

<script setup>
const props = defineProps({
  error: Object
})

const handleError = () => clearError({ redirect: '/' })
</script>
```

## 错误辅助方法

### `useError`

* `function useError (): Ref<any>`

这个方法返回一个正在处理的全局Nuxt错误。

::ReadMore{link="/api/composables/use-error"}
::

### `throwError`

* `function throwError (err: string | Error): Error`

你可以在客户端的任意点调用这个方法，或者在服务端的中间件，插件或`setup()` 函数中调用，它会触发一个全屏错误页面，你可以使用`clearError` 清除该页面。

::ReadMore{link="/api/utils/throw-error"}
::

### `clearError`

* `function clearError (options?: { redirect?: string }): Promise<void>`


该函数将清除当前处理的Nuxt错误，它接收一个可选的重定向路径，（例如：你想要跳转到的安全页面）

::ReadMore{link="/api/utils/clear-error"}
::

## 应用程序中的渲染错误

Nuxt 还提供了一个`<NuxtErrorBoundary>`组件，允许你处理应用程序中的客户端错误，而无需用错误页面来替换整个错误站点。

此组件负责处理其默认插槽内发生的错误，在客户端，它将防止错误冒泡到顶层，并将渲染内部的 `#error` 插槽。

`#error` 插槽会接收 `error`作为参数，（如果你设置`error=null`,这将会触发默认插槽重新渲染，你首先需要确保错误已经完全解决，否则error插槽会二次被渲染。）

::alert{type="info"}
如果你跳转到其他路由，错误会自动清除。
::

### 例子

```vue [pages/index.vue]
<template>
  <!-- some content -->
  <NuxtErrorBoundary @error="someErrorLogger">
    <!-- You use the default slot to render your content -->
    <template #error="{ error }">
      You can display the error locally here.
      <button @click="error = null">
        This will clear the error.
      </button>
    </template>
  </NuxtErrorBoundary>
</template>
```

:LinkExample{link="/examples/app/error-handling"}
