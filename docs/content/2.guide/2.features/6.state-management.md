# 状态管理

Nuxt 3 提供了 `useState` 组合项，创建跨组件的响应式和SSR友好的共享状态。

`useState` 是一种SSR 友好的，可替换[`ref`](https://vuejs.org/api/reactivity-core.html#ref) 。它的值将在服务端渲染后（在客户端起作用后）保留，并使用唯一的key 在组件之间共享。

::ReadMore{link="/api/composables/use-state"}
::

::alert{icon=👉}
`useSate` 只能在 `setup` 或者[`声明周期钩子函数`](https://vuejs.org/api/composition-api-lifecycle.html#composition-api-lifecycle-hooks)中使用。
::

## 最佳实践

::alert{type=danger icon=🚨}
不要在`<script setup>`或者`setup()`函数之外定义`const state = ref()`<br>
这样的状态会在访问你网站的所有用户使用，并且会导致内存泄漏！
::
::alert{type=success icon=✅}
应该使用 `const useX = () => useState('x')`
::

## 例子

### 基本用法

在这个例子中，我们使用组件局部计数器状态，使用`useState（'counter'）`的任何其他组件共享相同的响应状态。

```vue [app.vue]
<script setup>
const counter = useState('counter', () => Math.round(Math.random() * 1000))
</script>

<template>
  <div>
    Counter: {{ counter }}
    <button @click="counter++">
      +
    </button>
    <button @click="counter--">
      -
    </button>
  </div>
</template>
```

:LinkExample{link="/examples/composables/use-state"}

::ReadMore{link="/api/composables/use-state"}
::

### 进阶

在本例子中，我们使用了一个可组合程序，该程序从http请求头中检测用户的locle信息，并且保存到`local`中。

:LinkExample{link="/examples/other/locale"}

## 共享状态

通过使用[auto-imported 组合项](/guide/directory-structure/composables)我们可以定义安全的数据状态，并在应用程序中使用它们。

```ts [composables/states.ts]
export const useCounter = () => useState<number>('counter', () => 0)
export const useColor = () => useState<string>('color', () => 'pink')
```

```vue [app.vue]
<script setup>
const color = useColor() // Same as useState('color')
</script>

<template>
  <p>Current color: {{ color }}</p>
</template>
```
