# è¿è¡Œæ—¶é…ç½®

Nuxt æä¾›äº†è¿è¡Œæ—¶é…ç½®APIï¼Œç”¨äºåœ¨åº”ç”¨ç¨‹åºå’ŒæœåŠ¡å™¨è·¯ç”±ä¸­ä½¿ç”¨ï¼Œè¿˜å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡æ¥ä¿®æ”¹è¿™äº›é…ç½®ã€‚


## è®¾ç½®è¿è¡Œæ—¶é…ç½®

æŠŠé…ç½®å’Œç¯å¢ƒå˜äº†å…¬å¼€ç»™åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ï¼Œä½ éœ€è¦ä½¿ç”¨`nuxt.confg` æ–‡ä»¶ä¸­ä½¿ç”¨ [`runtimeConfig` é…ç½®é¡¹](/guide/directory-structure/nuxt.config#runtimeconfig)æ¥å®šä¹‰è¿è¡Œæ—¶çš„é…ç½®

**ä¾‹å­:**

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  runtimeConfig: {
    // è®¾ç½®ä¸€ä¸ªåªèƒ½åœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨çš„ç§æœ‰å¯†é’¥
    apiSecret: '123',
    // public  å¯¹è±¡é‡Œè®¾ç½®çš„key åœ¨ å®¢æˆ·ç«¯ä¹Ÿèƒ½ä½¿ç”¨
    public: {
      apiBase: '/api'
    }
  }
})
```

åœ¨ `runtimeConfig.public` ä¸­è®¾ç½®äº† `apiBase`, Nuxt ä¼šæŠŠè¿™ä¸ªé…ç½®æ·»åŠ åˆ°æ¯ä¸ªé¡µé¢çš„æœ‰æ•ˆè´Ÿè½½ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶åœ¨æœåŠ¡å™¨å’Œæµè§ˆå™¨ç«¯ä½¿ç”¨`apiBase`.


```js
const runtimeConfig = useRuntimeConfig()

console.log(runtimeConfig.apiSecret)
console.log(runtimeConfig.public.apiBase)
```

### ç¯å¢ƒå˜é‡

é€šå¸¸ä¼šä½¿ç”¨[ç¯å¢ƒå˜é‡](https://medium.com/chingu/an-introduction-to-environment-variables-and-how-to-use-them-f602f66d15fa) æ¥è®¾ç½®é…ç½®é¡¹ã€‚
.

::alert{type=info}
Nuxt CLI å†…ç½®äº†å¯¹ [dotenv](https://github.com/motdotla/dotenv)çš„æ”¯æŒï¼Œ

é™¤äº†é¡¹ç›®è¿›ç¨‹ä¸­çš„ç¯å¢ƒå˜äº†ï¼Œå¦‚æœä½ åœ¨é¡¹ç›®æ ¹ç›®å½•è®¾ç½®äº†`.env` æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­çš„é…ç½®é¡¹å¯ä»¥è‡ªåŠ¨åˆå¹¶åˆ°`process.env` ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒåœ¨`nuxt.confg` ä»¥åŠå…¶ä»–æ¨¡å—ä¸­ä½¿ç”¨ã€‚

ä½†æ˜¯ï¼Œ**é¡¹ç›®æ„å»ºå** æƒ³è¦åœ¨æœåŠ¡ç«¯ä¿®æ”¹ç¯å¢ƒå˜äº†ï¼Œè¿™ä¸ªæ—¶å€™`.env` ä¸ä¼šèµ·ä½œç”¨ã€‚
ä¾‹å¦‚:ä½ å¯ä»¥ä½¿ç”¨ç»ˆç«¯å‘½ä»¤æ¥è®¾ç½®å‚æ•°ï¼ŒDATABASE_HOST=mydatabaseconnectionstring node .output/server/index.mjs
::

è¿è¡Œæ—¶çš„é…ç½®ä¼šåœ¨è¿è¡Œæ—¶è‡ªåŠ¨æ›¿æ¢æˆç¯å¢ƒå˜é‡ã€‚ä¸ºæ­¤ï¼Œä½ å¿…é¡»åœ¨ `nuxt.config` ä¸­è®¾ç½®é»˜è®¤å€¼ã€‚

**ä¾‹å­:**

```sh [.env]
NUXT_API_SECRET=api_secret_token
NUXT_PUBLIC_API_BASE=https://nuxtjs.org
```

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  runtimeConfig: {
    apiSecret: '', // can be overridden by NUXT_API_SECRET environment variable
    public: {
      apiBase: '', // can be overridden by NUXT_PUBLIC_API_BASE environment variable
    }
  },
})
```

## è®¿é—®è¿è¡Œæ—¶é…ç½®

### Vue åº”ç”¨

åœ¨Nuxt é¡¹ç›®çš„Vueéƒ¨åˆ†ï¼Œä½ éœ€è¦è°ƒç”¨`useRuntimeConfig()` æ¥è®¿é—®è¿è¡Œæ—¶çš„é…ç½®ã€‚


**æ³¨æ„:** å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„ä½¿ç”¨æ–¹å¼ä¸ä¸€æ ·:

- åœ¨å®¢æˆ·ç«¯ï¼Œåªæœ‰ `public` ä¸­çš„çš„keyæ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œå¹¶ä¸”è¿™ä¸ªå¯¹è±¡æ˜¯å¯å†™å’Œå“åº”å¼çš„ã€‚
- åœ¨æœåŠ¡å™¨ç«¯ï¼Œæ‰€æœ‰çš„è¿è¡Œæ—¶é…ç½®éƒ½æ˜¯å¯ä»¥è®¿é—®çš„ï¼Œä½†æ˜¯éƒ½æ˜¯åªè¯»ä»¥é¿å…ä¸Šä¸‹æ–‡å…±äº«ã€‚


```vue
<template>
  <div>
    <div>Check developer console!</div>
  </div>
</template>

<script setup>
const config = useRuntimeConfig()
console.log('Runtime config:', config)
if (process.server) {
  console.log('API secret:', config.apiSecret)
}
</script>
```

**ğŸ›‘ å®‰å…¨æç¤º:** ä¸è¦æŠŠè¿è¡Œæ—¶çš„é…ç½®æ¸²æŸ“åˆ°é¡µé¢æˆ–æ”¾åˆ° `useState` ä¸­ä½¿ç”¨ã€‚.

::alert{icon=ğŸ‘‰}
**`useRuntimeConfig` åªèƒ½åœ¨ `setup` æˆ– `ç”Ÿå‘½å‘¨æœŸé’©å­`** ä¸­ä½¿ç”¨.
::

### æ’ä»¶

å¦‚æœè¦åœ¨è‡ªå®šä¹‰æ’ä»¶ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥åœ¨`defineNuxtPlugin` å‡½æ•°ä¸­ä½¿ç”¨  `useRuntimeConfig`Â·


ç¤ºä¾‹:

```ts
export default defineNuxtPlugin((nuxtApp) => {
  const config = useRuntimeConfig()
  console.log('API base URL:', config.public.apiBase)
});
```

### æœåŠ¡ç«¯è·¯ç”±

ä½ ä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨è·¯ç”±ä¸­é€šè¿‡`useRuntimeConfig` æ¥è®¿é—®è¿è¡Œæ—¶é…ç½®ã€‚

```ts
export default async () => {
  const result = await $fetch('https://my.api.com/test', {
    headers: {
      Authorization: `Bearer ${useRuntimeConfig().apiSecret}`
    }
  })
  return result
}
```

### æ‰‹åŠ¨è¾“å…¥è¿è¡Œæ—¶é…ç½®

Nuxt ä¼šé€šè¿‡[unjs/untyped](https://github.com/unjs/untyped)å°è¯•ä¸ºè¿è¡Œæ—¶é…ç½®è‡ªåŠ¨ç”ŸæˆTypescriptæ¥å£.

ä¹Ÿå¯æ—¶æ‰‹åŠ¨å±æ€§è¿è¡Œæ—¶é…ç½®çš„ç±»å‹ï¼š

```ts [index.d.ts]
declare module '@nuxt/schema' {
  interface RuntimeConfig {
    apiSecret: string
    public: {
      apiBase: string
    }
  }
}
// It is always important to ensure you import/export something when augmenting a type
export {}
```
