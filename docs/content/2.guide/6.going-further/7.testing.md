# Testing

::alert{icon=👉}
测试工具还处于开发阶段，API使用方式可能会变化，目前，可以供模块开发者预览，不适用于测试生产应用。
::

在Nuxt 3 中，重新开发了 `@nuxt/test-utils-edge` 来替换旧版的 `@nuxt/test-utils`, 我们支持[Vitest](https://github.com/vitest-dev/vitest) 和 [Jest](https://jestjs.io/)测试运行器。

## 安装

```bash
yarn add --dev @nuxt/test-utils-edge vitest
```

## 设置

在`@test/tet-utils`的每个辅助方法的每个`describe`块中，你需要在开始测试前设置上下文。

```ts
import { describe, test } from 'vitest'
import { setup, $fetch } from '@nuxt/test-utils-edge'

describe('My test', async () => {
  await setup({
    // test context options
  })

  test('my test', () => {
    // ...
  })
})
```

底层是`setup` 在 `beforeAll` `beforeEach` `afterEach` `Afterall` 中执行一些了的任务，来确保正确设置Nuxt测试环境

## 参数

### Nuxt配置

#### `rootDir`

要测试的Nuxt应用的目录路径。

* Type: `string`
* Default: `'.'`

#### `configFile`

配置文件的名字

* Type: `string`
* Default: `'nuxt.config'

<!--
#### config

Object with configuration overrides.

* Type: `NuxtConfig`
* Default: `{}` -->

### 设置时间

#### `setupTimeout`

允许`setupTest` 完成工作的总时间（以毫秒为单位），（可能包括Nuxt应用程序的构建和生产文件，取决于使用时设置的参数）

* Type: `number`
* Default: `60000`

### 开启某些功能

#### `server`

是否启动服务器来响应测试程序中的请求。

* Type: `boolean`
* Default: `true`

#### `build`

是否允许单独的构建步骤。

* Type: `boolean`
* Default: `true` (`false` if `browser` or `server` is disabled)

#### `browser`

在底层，Nuxt 使用[`playwright`](https://playwright.dev/)用于执行浏览器测试。如果设置了这个选项，会启动一个浏览器给在后续测试用例中操作。([参阅](/guide/going-further/testing))

* Type: `boolean`
* Default: `false`

#### `browserOptions`

* Type: `object` 有下列属性
  * **type**: 要启动浏览器的类型，可选值有 `chromium`, `firefox`  `webkit`
  * **launch**: `object` 启动浏览器时要传递给 paywright的参数. 参阅 [完整的API](https://playwright.dev/#version=master&path=docs%2Fapi.md&q=browsertypelaunchoptions).

#### `runner`

制定测试用例的运行器，目前推荐使用[Vitest](https://vitest.dev/) 

* Type: `'vitest' | 'jest'`
* Default: `'vitest'`

## APIs

### 用于渲染测试的API

#### `$fetch(url)`

获取服务器端渲染的HTML。

```ts
import { $fetch } from '@nuxt/test-utils'

const html = await $fetch('/')
```

#### `fetch(url)`

获取服务器渲染页面的请求。

```ts
import { fetch } from '@nuxt/test-utils'

const res = await fetch('/')
const { body, headers } = res
```

#### `url(path)`

获取指定页面的完整URL,(包括运行测试服务器的端口)

```ts
import { url } from '@nuxt/test-utils'

const pageUrl = url('/page')
// 'http://localhost:6840/page'
```

## 测试模块

### Fixture Setup

为了测试我们开发的模块，我们可以设置一些Nuxt应用的fixtrues 和测试它们的行为，例如，我们可以在Nuxt 应用的`./test/fixture`中传家配置文件:

```ts
// nuxt.config.js
import { defineNuxtConfig } from 'nuxt'
import MyModule from '../../src'

export default defineNuxtConfig({
  modules: [
    MyModule
  ]
})
```

### 测试设置
我们可以创建一个文件通过设置`rootDir`来测试 fixture

```ts
// basic.test.js
import { describe, it } from 'vitest'
import { fileURLToPath } from 'node:url'
import { setup, $fetch } from '@nuxt/test-utils-edge'

describe('ssr', async () => {
  await setup({
    rootDir: fileURLToPath(new URL('./fixture', import.meta.url)),
  })

  it('renders the index page', async () => {
    // Get response to a server-rendered page with `$fetch`.
    const html = await $fetch('/')

    expect(html).toContain('<a>A Link</a>')
  })
})
```
更多用例，请参考[Nuxt 3的测试框架](https://github.com/nuxt/framework/blob/main/test/basic.test.ts)。


## 在浏览器中测试

::alert{icon=🚧}
努力开发中，敬请期待！
::
