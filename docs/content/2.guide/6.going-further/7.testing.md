# Testing

::alert{icon=ğŸ‘‰}
æµ‹è¯•å·¥å…·è¿˜å¤„äºå¼€å‘é˜¶æ®µï¼ŒAPIä½¿ç”¨æ–¹å¼å¯èƒ½ä¼šå˜åŒ–ï¼Œç›®å‰ï¼Œå¯ä»¥ä¾›æ¨¡å—å¼€å‘è€…é¢„è§ˆï¼Œä¸é€‚ç”¨äºæµ‹è¯•ç”Ÿäº§åº”ç”¨ã€‚
::

åœ¨Nuxt 3 ä¸­ï¼Œé‡æ–°å¼€å‘äº† `@nuxt/test-utils-edge` æ¥æ›¿æ¢æ—§ç‰ˆçš„ `@nuxt/test-utils`, æˆ‘ä»¬æ”¯æŒ[Vitest](https://github.com/vitest-dev/vitest) å’Œ [Jest](https://jestjs.io/)æµ‹è¯•è¿è¡Œå™¨ã€‚

## å®‰è£…

```bash
yarn add --dev @nuxt/test-utils-edge vitest
```

## è®¾ç½®

åœ¨`@test/tet-utils`çš„æ¯ä¸ªè¾…åŠ©æ–¹æ³•çš„æ¯ä¸ª`describe`å—ä¸­ï¼Œä½ éœ€è¦åœ¨å¼€å§‹æµ‹è¯•å‰è®¾ç½®ä¸Šä¸‹æ–‡ã€‚

```ts
import { describe, test } from 'vitest'
import { setup, $fetch } from '@nuxt/test-utils-edge'

describe('My test', async () => {
  await setup({
    // test context options
  })

  test('my test', () => {
    // ...
  })
})
```

åº•å±‚æ˜¯`setup` åœ¨ `beforeAll` `beforeEach` `afterEach` `Afterall` ä¸­æ‰§è¡Œä¸€äº›äº†çš„ä»»åŠ¡ï¼Œæ¥ç¡®ä¿æ­£ç¡®è®¾ç½®Nuxtæµ‹è¯•ç¯å¢ƒ

## å‚æ•°

### Nuxté…ç½®

#### `rootDir`

è¦æµ‹è¯•çš„Nuxtåº”ç”¨çš„ç›®å½•è·¯å¾„ã€‚

* Type: `string`
* Default: `'.'`

#### `configFile`

é…ç½®æ–‡ä»¶çš„åå­—

* Type: `string`
* Default: `'nuxt.config'

<!--
#### config

Object with configuration overrides.

* Type: `NuxtConfig`
* Default: `{}` -->

### è®¾ç½®æ—¶é—´

#### `setupTimeout`

å…è®¸`setupTest` å®Œæˆå·¥ä½œçš„æ€»æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ï¼Œï¼ˆå¯èƒ½åŒ…æ‹¬Nuxtåº”ç”¨ç¨‹åºçš„æ„å»ºå’Œç”Ÿäº§æ–‡ä»¶ï¼Œå–å†³äºä½¿ç”¨æ—¶è®¾ç½®çš„å‚æ•°ï¼‰

* Type: `number`
* Default: `60000`

### å¼€å¯æŸäº›åŠŸèƒ½

#### `server`

æ˜¯å¦å¯åŠ¨æœåŠ¡å™¨æ¥å“åº”æµ‹è¯•ç¨‹åºä¸­çš„è¯·æ±‚ã€‚

* Type: `boolean`
* Default: `true`

#### `build`

æ˜¯å¦å…è®¸å•ç‹¬çš„æ„å»ºæ­¥éª¤ã€‚

* Type: `boolean`
* Default: `true` (`false` if `browser` or `server` is disabled)

#### `browser`

åœ¨åº•å±‚ï¼ŒNuxt ä½¿ç”¨[`playwright`](https://playwright.dev/)ç”¨äºæ‰§è¡Œæµè§ˆå™¨æµ‹è¯•ã€‚å¦‚æœè®¾ç½®äº†è¿™ä¸ªé€‰é¡¹ï¼Œä¼šå¯åŠ¨ä¸€ä¸ªæµè§ˆå™¨ç»™åœ¨åç»­æµ‹è¯•ç”¨ä¾‹ä¸­æ“ä½œã€‚([å‚é˜…](/guide/going-further/testing))

* Type: `boolean`
* Default: `false`

#### `browserOptions`

* Type: `object` æœ‰ä¸‹åˆ—å±æ€§
  * **type**: è¦å¯åŠ¨æµè§ˆå™¨çš„ç±»å‹ï¼Œå¯é€‰å€¼æœ‰ `chromium`, `firefox`  `webkit`
  * **launch**: `object` å¯åŠ¨æµè§ˆå™¨æ—¶è¦ä¼ é€’ç»™ paywrightçš„å‚æ•°. å‚é˜… [å®Œæ•´çš„API](https://playwright.dev/#version=master&path=docs%2Fapi.md&q=browsertypelaunchoptions).

#### `runner`

åˆ¶å®šæµ‹è¯•ç”¨ä¾‹çš„è¿è¡Œå™¨ï¼Œç›®å‰æ¨èä½¿ç”¨[Vitest](https://vitest.dev/) 

* Type: `'vitest' | 'jest'`
* Default: `'vitest'`

## APIs

### ç”¨äºæ¸²æŸ“æµ‹è¯•çš„API

#### `$fetch(url)`

è·å–æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„HTMLã€‚

```ts
import { $fetch } from '@nuxt/test-utils'

const html = await $fetch('/')
```

#### `fetch(url)`

è·å–æœåŠ¡å™¨æ¸²æŸ“é¡µé¢çš„è¯·æ±‚ã€‚

```ts
import { fetch } from '@nuxt/test-utils'

const res = await fetch('/')
const { body, headers } = res
```

#### `url(path)`

è·å–æŒ‡å®šé¡µé¢çš„å®Œæ•´URL,(åŒ…æ‹¬è¿è¡Œæµ‹è¯•æœåŠ¡å™¨çš„ç«¯å£)

```ts
import { url } from '@nuxt/test-utils'

const pageUrl = url('/page')
// 'http://localhost:6840/page'
```

## æµ‹è¯•æ¨¡å—

### Fixture Setup

ä¸ºäº†æµ‹è¯•æˆ‘ä»¬å¼€å‘çš„æ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€äº›Nuxtåº”ç”¨çš„fixtrues å’Œæµ‹è¯•å®ƒä»¬çš„è¡Œä¸ºï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Nuxt åº”ç”¨çš„`./test/fixture`ä¸­ä¼ å®¶é…ç½®æ–‡ä»¶:

```ts
// nuxt.config.js
import { defineNuxtConfig } from 'nuxt'
import MyModule from '../../src'

export default defineNuxtConfig({
  modules: [
    MyModule
  ]
})
```

### æµ‹è¯•è®¾ç½®
æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–‡ä»¶é€šè¿‡è®¾ç½®`rootDir`æ¥æµ‹è¯• fixture

```ts
// basic.test.js
import { describe, it } from 'vitest'
import { fileURLToPath } from 'node:url'
import { setup, $fetch } from '@nuxt/test-utils-edge'

describe('ssr', async () => {
  await setup({
    rootDir: fileURLToPath(new URL('./fixture', import.meta.url)),
  })

  it('renders the index page', async () => {
    // Get response to a server-rendered page with `$fetch`.
    const html = await $fetch('/')

    expect(html).toContain('<a>A Link</a>')
  })
})
```
æ›´å¤šç”¨ä¾‹ï¼Œè¯·å‚è€ƒ[Nuxt 3çš„æµ‹è¯•æ¡†æ¶](https://github.com/nuxt/framework/blob/main/test/basic.test.ts)ã€‚


## åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•

::alert{icon=ğŸš§}
åŠªåŠ›å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼
::
