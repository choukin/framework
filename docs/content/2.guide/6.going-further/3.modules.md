# 模块作者指南


 Nuxt 通过预设集成和最佳实践提供零配置体验来开发Web应用程序。
 强大的配置和挂钩系统，让Nuxt框架可以在每个生命周期进行自定义以及自定义集成，成为可能。你可以在[Nuxt 内部结构](/guide/going-further/internals)章节了解更多。

 Nuxt 提供了一个叫做 **Nuxt 模块**的API 。Nuxt 模块时一些简单的一步函数，在执行`nuxi dev` 或 `nuxi build` 时运行。

 使用Nuxt 模块我们可以封装自定义解决方案，正确的测试 作为npm包，不需要向Nuxt项目本身添加不需要的模版文件。Nuxt 模块可以挂到Nuxt 打包起的生命周期事件，提供运行时应用程序模版，更新配置或更具需要执行任何其他自定义操作。




## 快速开始

对于嫌麻烦的同学，你可以使用[mobule-builder](https://github.com/nuxt/module-builder) 和 [module starter template](https://github.com/nuxt/starter/tree/module)快速开始:

```bash
npx nuxi init -t module my-module
```

starter template  和 module 是创建 NuxtModule 的标准路径。

**下一步:**

1. 在编辑器中打开 `my-module`(推荐使用Visual Studio Code)
2. 使用包管理器安装依赖 (推荐使用Yarn)
3. 确定本地文件是通过 `npm run dev:prepare` 生成的
4. 运行 `npm run dev`
5. 按照本文档了解更多Nuxt 模块信息

::alert{type=info icon=🚧}
本指南持续更新。请定期检查更新
::

## 模块解刨

Nuxt模块是一个简单的函数，接收inlineOptions 和 `nuxt` 作为参数。

作为模块作者，剩下的逻辑如何处理取决于你。

从nuxt 3 开始，模块可以使所有的[Nuxt Kit](/api/advanced/kit)工具收益。



```ts [modules/example.ts]
// modules/module.mjs
export default async (inlineOptions, nuxt) => {
  // You can do whatever you like here..
  console.log(inlineOptions.token) // `123`
  console.log(nuxt.options.dev) // `true` or `false`
  nuxt.hook('ready', async nuxt => {
    console.log('Nuxt is ready')
  })
}
```

```ts [nuxt.config]
export default defineNuxtConfig({
  modules: [
    // Using package name (recommended usage)
    '@nuxtjs/example',

    // Load a local module
    './modules/example',

    // Add module with inline-options
    ['./modules/example', { token: '123' }]

    // Inline module definition
    async (inlineOptions, nuxt) => { }
  ]
})
```

## 定义Nuxt 模块

创建Nuxt模块设计繁琐且常见的业务。[Nuxt Kit](/api/advanced/kit) 使用 `defineNuxtModule` 提供了一个方便标准的API来定义Nuxt模块：

```js
import { defineNuxtModule } from '@nuxt/kit'

export default defineNuxtModule({
  meta: {
    // Usually  npm package name of your module
    name: '@nuxtjs/example',
    // The key in `nuxt.config` that holds your module options
    configKey: 'sample',
    // Compatibility constraints
    compatibility: {
      // Semver version of supported nuxt versions
      nuxt: '^3.0.0'
    }
  },
  // Default configuration options for your module
  defaults: {},
  hooks: {},
  async setup(moduleOptions, nuxt) {
    // -- Add your module logic here --
  }
})
```

`definedNuxtModule` 的返回值是一个带 `(inlineOptions, nuxt)` 签名的包装函数。它作用于默认和其他可能的步骤，并在调用时执行`setup`.


**`defineNuxtModule` 特性:**

::list

- 支持 `defaults` 和 `meta.configKey` 来自动合并模块选项
- 类型提示以及自动类型推导
- 添加垫片来兼容Nuxt 2
- 使用计算唯一的key`meta.name` 或 `meta.configKey`来确保模块只按照一次。
- 自动注册Nuxt钩子。
- 根据模块元信息自动检查兼容问题。
- 暴露 `getOptions` 和 `getMeta` 供Nuxt内部使用
- 只要确保模块使用最新版本`@/nuxt/kit`中的 `defineNuxtModule` 就可以保证向下和向上兼容。
- 预模块构建器工具集成

::

## 最佳实践

### 异步模块

Nuxt 模块可以进行异步操作。例如，你需要开发一个需要获取一些API或调用异步函数的模块。

::alert{type="warning"}
请注意，`nuxi dev` 在进入下一个模块并启动开发服务器之前，等你你的模块执行，使用延迟的Nuxt钩子执行耗时的逻辑。
::

### 始终为暴露的接口添加前缀

Nuxt 的模块要为任何公开的配置、插件、API、组合项、和组件提供一个显示的前缀，用来避免和其他模块以及自己内部产生冲突。

理想情况下，你需要用模块名作为前缀（如果模块名称是 `nuxt-foo` 使用 `<FooButton>` `useFooBar()` 而不是`<Foo>` `useBar()`）

### 对TypeScript友好

Nuxt 3 集成了Typescript 来提供最好的开发体验。

即使不直接使用typescript开发模块 ,也可以让使用者使用通过Typescript使用。（自己的理解）

### 避免使用 CommonJS 语法

Nuxt 3 依赖原生 ESM, 请阅读[Native ES Modules](/guide/going-further/esm) 获取更多信息。

## 模块生态系统

Nuxt 会拥有一个加快而丰富的Nuxt 模块和集成的生态系统。想要加入我们，请阅读下面的最佳实践：

### 使用文档模块

在模块的自述文件中描述列内容:

- 为什么使用这个模块
- 如何使用这个模块
- 这个模块是做什么的？


链接到集成网址和模块文档总是很棒的！

### 包名使用 `nuxt-` 前缀 

要想你的包更容易被找到，请使用`nuxt-`作为前缀。这是要实现自己想法的第一步。


### 在 modules.nuxtjs.org 中列出你的模块

你又在使用的模块并且想要在 [modules.nuxtjs.org](https://modules.nuxtjs.org)中列出吗？在 [nuxt/modules](https://github.com/nuxt/modules/issues/new)中新开一个issue。Nuxt 团队可以帮助你把它在网站上列出来。


### 不要使用固定的Nuxt 3 版本

Nuxt 3, Nuxt Kit 和其他新的工具，在设计时考虑到了前后兼容。

请使用 `X for Nuxt` 而不是`X for Nuxt 3` 来避免生态的碎片化，推荐使用`meta.compatiblility` 来设置Nuxt 版本约束。


### 加入Nuxt 社区

通过把你的模块移动到[nuxt-community]()，总有人可以提供帮助，这样我们可以一起制定一个完美的解决方案。

如果你的模块已经发布并且还在使用，想要把它转移到 nuxt 社区，请来[nuxt/modules](https://github.com/nuxt/modules/issues/new)新建一个issue.

## 实例

### 提供Nuxt 插件

通常，模块会提供一个或多个运行插件来扩展运行时的逻辑。

```ts
import { defineNuxtModule, addPlugin, createResolver } from '@nuxt/kit'

export default defineNuxtModule<ModuleOptions>({
  setup (options, nuxt) {
    // 解析相对路径
    const { resolve } = createResolver(import.meta.url)

    addPlugin(resolve('./runtime/plugin'))
  }
})
```

::ReadMore{link="/api/advanced/kit" title="API > Advanced > Kit"}
::

### 添加一个CSS库

如果模块要提供一个CSS库，为了避免重复请检查用户是否已经包含这个库。并添加一个选项值来禁用模块提供的CSS库。

```ts
import { defineNuxtModule } from '@nuxt/kit'

export default defineNuxtModule({
  setup (options, nuxt) {
    nuxt.options.css.push('font-awesome/css/font-awesome.css')
  }
})
```

### 清理模块

如果你的模块中开启了监听，在nuxt生命周期结束时需要关闭监听，这种情况我们可以shying `close`钩子：

```ts
import { defineNuxtModule } from '@nuxt/kit'

export default defineNuxtModule({
  setup (options, nuxt) {
    nuxt.hook('close', async nuxt => {
      // Your custom code here
    })
  }
})
```
