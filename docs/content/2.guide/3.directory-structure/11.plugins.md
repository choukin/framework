---
icon: IconDirectory
title: 'plugins'
head.title: 插件目录
---

# 插件目录

Nuxt 会自动读取并加载 `plugins/`中的文件。可以添加 `.server` 或 `.client` 后缀的的文件名让插件只在服务器或客户端执行。


::alert{type=warning}
`plugins/`目录中的插件都会自动注册，所以你不需要单独在 `nuxt.config`中添加。
::

## 哪些文件会被注册

只有`plugins/`中顶层的文件（或者子目录中的index文件）会被注册为插件。


示例:

```bash
plugins
 | - myPlugin.ts
 | - myOtherPlugin
 | --- supportingFile.ts
 | --- componentToRegister.vue
 | --- index.ts
```

只有 `myPlugin.ts` 和 `myOtherPlugin/index.ts` 会被注册.

## 创建插件

插件只接收[`nuxtApp`](/api/composables/use-nuxt-app)) 参数。

```ts
export default defineNuxtPlugin(nuxtApp => {
  // Doing something with nuxtApp
})
```

## 自动的辅助函数

如果你想给`NuxtApp`实例提供一个辅助函数，在返回对象中的`provide` 中添加函数。例如：

```ts
export default defineNuxtPlugin(() => {
  return {
    provide: {
      hello: (msg: string) => `Hello ${msg}!`
    }
  }
})
```
在其他文件中的使用方式：

```vue
<template>
  <div>
    {{ $hello('world') }}
  </div>
</template>

<script setup lang="ts">
// alternatively, you can also use it here
const { $hello } = useNuxtApp()
</script>
```

## 插件类型

如果你从插件中返回了自定义的辅助函数，它们会自动类型推导，你会发现它们会从`usenuxtApp()`返回是自动动类型推导，也可以在模版中使用。

::alert
如果你需要在另一个插件内部使用辅助函数，你可以调用 `useNuxtApp()` 来获得类型版本，但一般情况下，除非你确定插件的调用顺序，否则应该避免这种情况。
::

### 进阶

对于高级用例，你可以这样声明注入属性的类型：

```ts [index.d.ts]
declare module '#app' {
  interface NuxtApp {
    $hello (msg: string): string
  }
}

declare module '@vue/runtime-core' {
  interface ComponentCustomProperties {
    $hello (msg: string): string
  }
}

export { }
```

## Vue 插件

如果你想使用Vue 插件，例如[vue-gtag](https://github.com/MatteoGabriele/vue-gtag),来添加GOOgle统计，标签，你可以使用Nuxt插件来实现。

> 有一个 开源的RFC 使得更容易实现这个功能[nuxt/framework#1175](https://github.com/nuxt/framework/discussions/1175)

首先安装你想要的插件。

```bash
yarn add --dev vue-gtag-next
```

创建一个名字是 `plugins/vue-gtag.client.js` 的插件

```ts
import VueGtag from 'vue-gtag-next'

export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.vueApp.use(VueGtag, {
    property: {
      id: 'GA_MEASUREMENT_ID'
    }
  })
})
```

## Vue 指令

类似地，你可以在插件中注册一个自定义的Vue指令，例如：在`plugins/directive.ts`中

```ts
export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.vueApp.directive('focus', {
    mounted (el) {
      el.focus()
    },
    getSSRProps (binding, vnode) {
      // you can provide SSR-specific props here
      return {}
    }
  })
})
```

:ReadMore{link="https://vuejs.org/guide/reusability/custom-directives.html"}

:LinkExample{link="/examples/app/plugins"}
