---
icon: IconDirectory
title: 'middleware'
head.title: 中间件目录
---

# 中间件目录

Nuxt 提供了自定义**路由中间件**框架在整个项目中可用，非常适合在导航到指定路由时扩展代码。

::alert{type=info}

路由中间件在Nuxt应用的Vue布局运行。尽管名字类似，但它们和服务器中间件完全不同，后者在应用的Nitro服务中运行。

::

有三种类型的路由中间件：

1. 匿名（或行内）路由中间件，直接在使用它们的页面中定义。
2. 命名中间件，放置在`middleware/` 目录中，会在导入它们的页面中自动异步加载.（**注意**： 路由中间件的名称是驼峰格式，所以 `someMiddleware` 会变成 `some-middleware`.）
3. 全局路由中间件，放置在 `middleware/`目录中（使用`.global`后缀）会在路由变化时自动运行。

前两种路由中间件可以[定义在 `definePageMeta`](/guide/directory-structure/pages)中。


## 格式


路由中间件时导航守卫，接收当前路由和下一个路由作为参数。

```js
export default defineNuxtRouteMiddleware((to, from) => {
  if (to.params.id === '1') {
    return abortNavigation()
  }
  return navigateTo('/')
})
```

Nuxt 提供了两个全局的辅助函数，可以直接从中间件返回值中获取。

1. `navigateTo(route:string|Route, opitons:{redirectCode:number, replace:boolean})` - 重定向到插件或中间件内给定的路由，也可以直接调用它来执行页面导航。
2. `abortNavigation(err?:string|Error)` 终止导航，错误消息可选。


不同于[Vue-router 文档](https://router.vuejs.org/guide/advanced/navigation-guards.html#global-before-guards)中的导航守卫，第三个参数`next()`没有传递，重定向或路由取消是通过中间件返回值来处理的，可能的返回值有：

* 没有返回值 - 不阻塞导航并且会执行下一个中间件函数，如果有并且匹配到了路由导航。
* `return navigateTo('/')` 或者 `return navigateTo({path:'/'})` 重定向到给定的路由，并且如果重定向发生在服务器端，湖设置重定向值为[`302` Fond](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/302)。
* `return navigateTo('/', {redirectCode: 301})` 重定向到给定的路由，如果重定向发生在服务器端，会返回编码 [`301` Moved Permanently](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/301).


::ReadMore{link="/api/utils/navigate-to"}
::

* `return abortNavigation()` - 停止当前导航
* `return abortNavigation(error)` - 拒绝当前导航并且报错

::ReadMore{link="/api/utils/abort-navigation"}
::

::ReadMore{link="/guide/features/routing"}
::

::alert{type=warning}
我们建议使用上面辅助函数来执行重定向或停止导航，另外，[vue-router 文档](https://router.vuejs.org/guide/advanced/navigation-guards.html#global-before-guards)描述的其他返回值，有可能起作用,未来可能会有不兼容的变化。

::

## 动态添加中间件

可以使用`addRouteMiddleware()` 帮助函数来手动添加全局或命名中间件。比如使用一个插件：

```ts
export default defineNuxtPlugin(() => {
  addRouteMiddleware('global-test', () => {
    console.log('this global middleware was added in a plugin and will be run on every route change')
  }, { global: true })

  addRouteMiddleware('named-test', () => {
    console.log('this named middleware was added in a plugin and would override any existing middleware of the same name')
  })
})
```

## 示例: 一个具名路由中间件

```bash
-| middleware/
---| auth.ts
```

在你的页面文件中，你可以应用这个路由中间件

```vue
<script setup>
definePageMeta({
  middleware: ["auth"]
  // or middleware: 'auth'
})
</script>
```

现在，在导航到这个页面前，会执行`auth`这个中间件。

:LinkExample{link="/examples/routing/middleware"}
